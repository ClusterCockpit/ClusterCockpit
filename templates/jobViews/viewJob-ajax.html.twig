{% extends 'base.html.twig' %}
{% set mode = 'view' %}
{% set id = job.id %}

{% block title %}
    Job {{ job.jobId }}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/datatables.min.css') }}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block javascript %}
    {{ parent() }}
    <script src="{{ asset('js/datatables.min.js') }}"/></script>
    <script src="{{ asset('js/plotly.min.js') }}"/></script>
    <script src="{{ asset('js/app.js') }}"/></script>
    <script src="{{ asset('js/tag-control.js') }}"/></script>
{% endblock %}

{% block helptext %}
    <h4>Roofline plot</h4>
    <p>
    </p>
    <h4>Polar plot</h4>
    <p>
    </p>
    <h4>Metric plots</h4>
    <p>
    </p>
    <h4>Node statistic table</h4>
    <p>
    </p>
{% endblock %}

{% block body %}
<div class="modal" id="tagmodal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add tag</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>


    <div class="row justify-content-center">
        <div class="col-3 ">
            <div class="row">
                <div class="col">
                    <table class="table table-sm table-striped">
                        <tbody>
                            <tr>
                                <th scope="col"> Job id </th>
                                <td scope="col"> {{ job.jobId }} </td>
                            </tr>
                            <tr>
                                <th scope="col"> User name </th>
                                <td scope="col"> {{ job.user.name }} </td>
                            </tr>
                            <tr>
                                <th scope="col"> User id </th>
                                <td scope="col">
                                    <a href="{{ path('show_user',{ 'id':job.user.id }) }}">
                                        {{ job.user.userId }}
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th scope="col"> Number of nodes </th>
                                <td scope="col"> {{ job.numNodes }} </td>
                            </tr>
                            <tr>
                                <th scope="col"> Job start </th>
                                <td scope="col">{{ job.startTime|date('d.m.y - H:i') }}</td>
                            </tr>
                            <tr>
                                <th scope="col"> Walltime </th>
                                <td scope="col">{{ "%5.2f hours"|format(job.duration / 3600) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-4">
                    <button type="button" class="btn btn-info"  href="#helpmodal"  data-toggle="modal" data-target="#helpmodal">
                        <h5 class="text-center m-2">
                            <i class="fas fa-question-circle fa-lg"></i> Help
                        </h5>
                    </button>

                    <div id='tag-form' class='invisible'>
                        <form>
                            <div class="form-group mt-2">
                                <input type="tagname" class="form-control" id="tagname"  placeholder="tag name">
                            </div>
                            <div class="form-group">
                                <input type="tagtype" class="form-control" id="tagtype" placeholder="tag type">
                            </div>
                            <button id='tag-add' type="button" name="add" class="btn btn-success" data-job-id="{{ job.id }}"><span class="fas fa-check fa-lg"></span></button>
                            <button id='tag-cancel' type="button" name="cancel" class="btn btn-danger"><span class="fas fa-times fa-lg"></span></button>
                        </form>
                    </div>
                </div>
                <div class="col-8" id='tagarea'>
                    {% for tag in job.tags %}
                        <span class="badge badge-warning" >
                            {{ tag.name }}
                            <button type="button" class="btn btn-outline-dark btn-sm tag-remove"  data-job-id="{{ job.id }}" data-tag-id="{{ tag.id }}">
                                <i class="fas fa-times fa-sm"></i>
                            </button>
                        </span>
                    {% endfor %}
                    <button type="button" class="btn btn-secondary btn-sm tag-enter">
                        <i class="fas fa-tag"></i> Add Tag
                    </button>
                </div>
            </div>
        </div>
        <div class="col-4" id="roofline"> </div>
        <div class="col-4" id="polarplot"> </div>
    </div>

    {% set metrics = job.cluster.metricLists[mode].metrics %}
    {% set margin = 'mt-4' %}

    <div class="row">
        {% for metric in metrics %}
            <div class="col {{ margin }}" id="{{ metric.name }}"></div>
        {% endfor %}
    </div>

    {% set metrics = job.cluster.metricLists['stat'].metrics %}
    {% set viewStatTable = config['plot_view_showStatTable'].value|default('true') %}
    {% if  viewStatTable is same as('true') %}
        <div class="row">
            <div class="col  mt-5">
                <table class="table table-striped" id="stat">
                    <thead>
                        <th style="font-size: 0.9rem;" scope="col">nodeId</th>
                        {% for metric in metrics%}
                            <th style="font-size: 0.8rem;" scope="col">{{ metric.name }} min [{{ metric.unit }}]</th>
                            <th style="font-size: 0.8rem;" scope="col">{{ metric.name }} max [{{ metric.unit }}]</th>
                            <th style="font-size: 0.8rem;" scope="col">{{ metric.name }} avg [{{ metric.unit }}]</th>
                        {% endfor %}
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    {% endif %}
{% endblock %}
